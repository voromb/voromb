name: Metrics
on:
  # Todos los días a las 06:00 UTC ≈ 08:00 Madrid
  schedule: [{ cron: "0 6 * * *" }]
  workflow_dispatch:
jobs:
  github-metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      # Necesario para asegurar que el repositorio está correctamente clonado
      - name: Checkout
        uses: actions/checkout@v3
        
      # Usa la acción de métricas
      - name: Generate metrics
        uses: lowlighter/metrics@latest
        with:
          # === Seguridad ===
          token: ${{ secrets.METRICS_TOKEN }}      # Tu PAT personal
          committer_token: ${{ secrets.GITHUB_TOKEN }}  # Para hacer el commit del SVG
          # === Configuración de archivo ===
          filename: github-metrics.svg             # Nombre resultante
          output_action: commit                    # Haz commit automático
          committer_branch: main                   # Define explícitamente la rama
          # === Configuración general ===
          template: classic
          user: voromb                             # (puede omitirse; se infiere)
          config_timezone: Europe/Madrid
          # === Bloques base ===
          base: header, activity, community, repositories
          # === Plugins ===
          plugin_languages: yes
          plugin_languages_limit: 8
          plugin_isocalendar: yes
          plugin_lines: yes
          plugin_achievements: yes
          plugin_achievements_threshold: B         # Solo logros ≥ rango B
          plugin_followup: yes                     # "¿A quién sigues y te sigue?"
